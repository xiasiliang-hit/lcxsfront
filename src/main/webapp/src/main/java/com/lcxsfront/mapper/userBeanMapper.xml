<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lcxsfront.mapper.userBeanMapper" >
  <resultMap id="BaseResultMap" type="com.lcxsfront.model.userBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="vid" property="vid" jdbcType="BIGINT" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="owninvitation" property="owninvitation" jdbcType="VARCHAR" />
    <result column="invitation" property="invitation" jdbcType="VARCHAR" />
    <result column="alipay" property="alipay" jdbcType="VARCHAR" />
    <result column="realname" property="realname" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="kf" property="kf" jdbcType="VARCHAR" />
    <result column="ctime" property="ctime" jdbcType="VARCHAR" />
    <result column="ip" property="ip" jdbcType="VARCHAR" />
    <result column="level" property="level" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    id, vid, phone, password, owninvitation, invitation, alipay, realname, status, kf, 
    ctime, ip, level
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from c_user
    where vid = #{vid,jdbcType=BIGINT}
  </select>
  
  <select id="queryUserByPhone" resultType="com.lcxsfront.model.userBean" parameterType="java.lang.String"> 
  	select
  	<include refid="Base_Column_List" />
    from c_user
    where phone=#{phone}
  </select>
  
  
  
  <select id="queryTotalMoneyByVid" resultType="java.lang.Object" parameterType="java.lang.Long">
  	select SUM(jmoney)+SUM(redmoney) from c_receipt r INNER JOIN(
	select u.rid from c_user c INNER JOIN c_user_receipt u on c.vid=u.vid and c.vid=#{vid}) z
	on z.rid=r.rid and r.status=4
  </select>
  
  <select id="queryTMoneyByVid" resultType="java.lang.Object" parameterType="java.lang.Long">
  	select SUM(r.tmoney) from c_user_receipt u 
  	INNER JOIN c_receipt r on r.rid=u.rid and u.vid=#{vid} and r.status=4
  </select>
  
  <select id="queryTodayMoneyByVid" resultType="java.lang.Object" parameterType="java.lang.Long">
  	SELECT SUM(jmoney)+SUM(redmoney) from c_receipt r INNER JOIN(
	select u.rid from c_user c INNER JOIN c_user_receipt u on c.vid=u.vid and c.vid=#{vid}) z
	on z.rid=r.rid and r.status=4 and <![CDATA[TO_DAYS(NOW()) - TO_DAYS(mtime) = 0]]>
  </select>
  
  <select id="qeuryReceiptByVid" resultType="java.lang.Object" parameterType="java.lang.Long">
	SELECT r.id from c_receipt r INNER JOIN(
	select u.rid from c_user c INNER JOIN c_user_receipt u on c.vid=u.vid and c.vid=#{vid}) z
	on z.rid=r.rid and r.status=3
  </select>
  
  <select id="queryAllMessageByVid" resultType="com.lcxsfront.model.userReceiptMessage" parameterType="com.lcxsfront.model.userBean">
  	select a.ctime as ctime,a.status as status,a.context as context,a.re as realname,
  	a.phone as phone,a.jmoney as money,s.ftime as ftime
  	,a.ttime as ttime,a.productname as pname,a.alipay as schedule,a.realname as name,
  	s.casename as typestz,s.dtime as dtime,a.redmoney as red
  	 from c_case s INNER JOIN(select z.ctime,z.status,z.context,z.realname as re,
  	 z.phone,z.ttime,z.caseid,z.vid,z.productname,b.alipay,b.realname,z.jmoney,z.redmoney from c_user b 
  	 INNER JOIN(select c.ctime,c.status,c.context,c.realname,c.phone,c.ttime,c.caseid,c.jmoney,c.redmoney,
  	 c.productname,u.vid from c_receipt c INNER JOIN 
	c_user_receipt u on c.rid=u.rid and u.vid=#{vid}) z
	on b.vid=z.vid) a
    on s.id=a.caseid 
	<if test="owninvitation!=null">
		and a.productname like "%"#{owninvitation}"%" 
	</if>
	ORDER BY a.ctime desc
	 limit #{page},#{limit}
  </select>
  
  <select id="queryReceiptNumByVid" resultType="java.lang.Object" parameterType="com.lcxsfront.model.userBean">
  select count(1) from c_user_receipt where vid=#{vid}  
  </select>
  
  
  <select id="queryPersonMessageByVid" resultType="com.lcxsfront.model.personMessage" parameterType="java.lang.Long">
  select a.phone as phone,a.alipay as alipay,k.cardid as cardid,k.name as name,k.obank as obank,a.realname as realname
   from c_bank k INNER JOIN(select u.phone,u.alipay,b.bid,u.realname from c_user u INNER JOIN 
  c_user_bank b on u.vid=b.vid and u.vid=#{vid}) a
   on a.bid=k.id
  </select>
  
  <select id="login" resultType="com.lcxsfront.model.userBean" parameterType="com.lcxsfront.model.userBean">
  	select
  	<include refid="Base_Column_List" />
    from c_user
    where phone=#{phone} and password=#{password}
  </select>
  
  <select id="queryPhone" resultType="java.lang.String">
  	select phone from c_user where status=1
  </select>
  
  <select id="queryUserFriendReceipt" resultType="com.lcxsfront.model.userFriendReceiptBean" parameterType="com.lcxsfront.model.userFriendReceiptBean">
  	select z.phone as phone,c.ttime as ctime,c.status as status,
  	c.ttime as ttime, c.productname as pname from c_receipt c INNER JOIN
    (select u.phone,u.ctime,r.rid from c_user u  INNER JOIN c_user_receipt r 
    on u.vid=r.vid and u.invitation=#{ctime})z
    ON c.rid=z.rid limit #{page},#{limit}
  </select>
  
  <select id="queryUserFriendReceiptNum" resultType="java.lang.Object" parameterType="java.lang.String">
  	select count(1) from c_receipt c INNER JOIN
    (select u.owninvitation,u.ctime,r.rid from c_user u  INNER JOIN c_user_receipt r on u.vid=r.vid and u.invitation=#{ucode})z
    ON c.rid=z.rid 
  </select>
  
  
  <select id="queryInvitationNumByUcode" resultType="java.lang.Object" parameterType="java.lang.String">
  	select count(1) from c_user where invitation=#{ucode}
  </select>
  
  <select id="queryNumByUcde" resultType="java.lang.Long" parameterType="java.lang.String">
  	select vid from c_user where invitation=#{ucode}
  </select>
  
  <select id="queryNumByVid" resultType="java.lang.Object" parameterType="java.lang.Long">
    select c.rid from c_user_receipt r INNER JOIN c_receipt c on 
    c.rid=r.rid and r.vid=#{vid} and (c.status=3 or c.status=4)
  </select>
  
  <select id="queryMoneyByUcode" resultType="java.lang.Double" parameterType="java.lang.String">
  	select (ljmoney+dkmoney) from c_invitation where ucode=#{ucode}
  </select>
  
  <select id="queryDkmoneyByUcode" resultType="java.lang.Object" parameterType="java.lang.String">
  	select dkmoney from c_invitation where ucode=#{ucode}
  </select>
  
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    delete from c_user
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.lcxsfront.model.userBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    insert into c_user (id, vid, phone, 
      password, owninvitation, invitation, 
      alipay, realname, status, 
      kf, ctime, ip, level
      )
    values (#{id,jdbcType=BIGINT}, #{vid,jdbcType=BIGINT}, #{phone,jdbcType=VARCHAR}, 
      #{password,jdbcType=VARCHAR}, #{owninvitation,jdbcType=VARCHAR}, #{invitation,jdbcType=VARCHAR}, 
      #{alipay,jdbcType=VARCHAR}, #{realname,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, 
      #{kf,jdbcType=VARCHAR}, #{ctime,jdbcType=VARCHAR}, #{ip,jdbcType=VARCHAR}, #{level,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective"  parameterType="com.lcxsfront.model.userBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    insert into c_user
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="vid != null" >
        vid,
      </if>
      <if test="phone != null" >
        phone,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="owninvitation != null" >
        owninvitation,
      </if>
      <if test="invitation != null" >
        invitation,
      </if>
      <if test="alipay != null" >
        alipay,
      </if>
      <if test="realname != null" >
        realname,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="kf != null" >
        kf,
      </if>
      <if test="ctime != null" >
        ctime,
      </if>
      <if test="ip != null" >
        ip,
      </if>
      <if test="level != null" >
        level,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="vid != null" >
        #{vid,jdbcType=BIGINT},
      </if>
      <if test="phone != null" >
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="owninvitation != null" >
        #{owninvitation,jdbcType=VARCHAR},
      </if>
      <if test="invitation != null" >
        #{invitation,jdbcType=VARCHAR},
      </if>
      <if test="alipay != null" >
        #{alipay,jdbcType=VARCHAR},
      </if>
      <if test="realname != null" >
        #{realname,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="kf != null" >
        #{kf,jdbcType=VARCHAR},
      </if>
      <if test="ctime != null" >
        #{ctime,jdbcType=VARCHAR},
      </if>
      <if test="ip != null" >
        #{ip,jdbcType=VARCHAR},
      </if>
      <if test="level != null" >
        #{level,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lcxsfront.model.userBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    update c_user
    <set >
      <if test="phone != null" >
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="owninvitation != null" >
        owninvitation = #{owninvitation,jdbcType=VARCHAR},
      </if>
      <if test="invitation != null" >
        invitation = #{invitation,jdbcType=VARCHAR},
      </if>
      <if test="alipay != null" >
        alipay = #{alipay,jdbcType=VARCHAR},
      </if>
      <if test="realname != null" >
        realname = #{realname,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="kf != null" >
        kf = #{kf,jdbcType=VARCHAR},
      </if>
      <if test="ctime != null" >
        ctime = #{ctime,jdbcType=VARCHAR},
      </if>
      <if test="ip != null" >
        ip = #{ip,jdbcType=VARCHAR},
      </if>
      <if test="level != null" >
        level = #{level,jdbcType=VARCHAR},
      </if>
    </set>
    where vid = #{vid,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lcxsfront.model.userBean" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 16:48:56 CST 2018.
    -->
    update c_user
    set vid = #{vid,jdbcType=BIGINT},
      phone = #{phone,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      owninvitation = #{owninvitation,jdbcType=VARCHAR},
      invitation = #{invitation,jdbcType=VARCHAR},
      alipay = #{alipay,jdbcType=VARCHAR},
      realname = #{realname,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      kf = #{kf,jdbcType=VARCHAR},
      ctime = #{ctime,jdbcType=VARCHAR},
      ip = #{ip,jdbcType=VARCHAR},
      level = #{level,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
</mapper>